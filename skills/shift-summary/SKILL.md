---
name: shift-summary
description: Generate shift or daily summaries on request — aggregate fleet activity, compliance, issues, and maintenance
metadata: {"openclaw":{"requires":{"bins":["redis-cli"],"env":["REDIS_URL"]}}}
---

# Shift Summary

_Generate shift or daily summaries on request — aggregate fleet activity, compliance, issues, and maintenance._

## Trigger

- **Message** — User asks for a summary ("how was day shift?", "shift summary", "what happened today?", "recap the last 12 hours", "weekly summary")

## Input

- **User messages:** Summary requests with optional time period ("today", "last shift", "this week", "last 24 hours")
- **Redis keys:**
  - `fleet:index:active` — SET of active asset IDs
  - `fleet:asset:{ID}:fuel` — STREAM (XRANGE for the requested time period)
  - `fleet:asset:{ID}:meter` — STREAM (XRANGE for the requested time period)
  - `fleet:asset:{ID}:preop` — STREAM (XRANGE for the requested time period)
  - `fleet:asset:{ID}:issues` — STREAM (XRANGE for the requested time period)
  - `fleet:asset:{ID}:maintenance` — STREAM (XRANGE for the requested time period)
  - `fleet:asset:{ID}:alerts` — STREAM (XRANGE for the requested time period)
- **MEMORY.md:** Fleet Health and Compliance Trends sections for context

## Behavior

Shift summaries are how supervisors and managers understand what happened while they were away. The goal is a concise, scannable overview — not a wall of data.

### Determining the time period

Parse the user's request for a time period:

- "Day shift" or "last shift" — last 12 hours
- "Today" — since midnight (or since 06:00 if that's more useful for mining operations)
- "This week" — last 7 days
- "Last 24 hours" — exactly that
- No time specified — default to last 12 hours (one shift)

Convert the time period to a Unix timestamp for XRANGE queries against Redis streams. Use that timestamp as the start parameter, with "+" as the end.

### Gathering data

For the determined time period, iterate over active assets and aggregate from their streams. For each asset in `fleet:index:active`:

1. Count fuel entries from the fuel stream for this period.
2. Count and check pre-op entries — how many were completed, how many passed vs. partial vs. failed.
3. Count meter readings submitted.
4. Read any issues reported, noting severity and whether the machine was still operational.
5. Read any maintenance completed, noting what was done and outcomes.
6. Read any anomaly alerts generated.

### Building the summary

Structure the summary as a brief, bullet-pointed overview:

**Fleet activity:** How many assets were active during the period. Any that went idle or came back online.

**Fuel logging:** Total fuel entries logged across the fleet. Number of assets that logged fuel vs. total active. Fleet-wide total liters if useful.

**Pre-op completion:** How many pre-ops were completed out of total active assets. Pass/partial/fail breakdown. Highlight any failures with the asset ID and what was flagged.

**Meter readings:** How many submitted this period.

**Issues reported:** List any new issues with asset ID, category, and whether the machine is still operational. This is the most important section — new problems that need attention.

**Maintenance completed:** List any maintenance logged by mechanics, with asset ID and what was done.

**Anomalies detected:** List any alerts generated by the anomaly detector during this period.

### Presentation

Lead with the exceptions — problems, gaps, and anything unusual. The routine stuff (fuel logged, pre-ops done) comes after. A supervisor wants to know what needs their attention, not that 30 machines successfully logged fuel.

Keep it short. If the fleet is large, aggregate by category rather than listing every asset. "28 of 32 active assets logged fuel" is better than listing all 28. Only name specific assets when they're the exception — the ones that didn't log, the ones with issues, the ones that got maintenance.

For weekly summaries, present trends rather than daily detail. "Pre-op compliance improved from 75% to 88% this week" is more useful than seven daily breakdowns.

If nothing notable happened during the period, say so briefly. "Quiet shift — all pre-ops done, fuel logging on track, no new issues reported."

## Output

- **Messages to user:** Formatted shift or period summary, bullet-pointed and scannable.
- **No Redis writes.** Shift-summary is read-only.
- **No MEMORY.md changes.** Shift-summary doesn't persist anything — the data lives in Redis streams and MEMORY.md is managed by the memory-curator.
