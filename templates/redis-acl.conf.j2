# Redis ACL Configuration for Fleetclaw
# Generated from fleet.yaml - DO NOT EDIT DIRECTLY
# Regenerate with: python scripts/generate-configs.py
#
# This file defines per-asset users with minimal required permissions.
# Each asset can only access its own inbox and fleet-wide channels.

# =============================================================================
# DEFAULT USER (disabled for security)
# =============================================================================
user default off

# =============================================================================
# FLEET COORDINATOR - Full fleet access
# =============================================================================
user fleet_coord on >${REDIS_PASSWORD_FLEET_COORD} ~fleet:* &fleet:* +@all

# =============================================================================
# ASSET USERS - Scoped access per asset
# =============================================================================
{% for asset in assets %}
# {{ asset.asset_id }} - {{ asset.type | title }}
# fleet:inbox — own inbox; fleet:status:* — read peer status, write own; fleet:alerts/commands — fleet channels
user {{ asset.asset_id | lower | replace('-', '_') }} on >${REDIS_PASSWORD_{{ asset.asset_id | replace('-', '_') }}} ~fleet:inbox:{{ asset.asset_id }} ~fleet:status:* ~fleet:test:{{ asset.asset_id }} ~fleet:alerts ~fleet:commands &fleet:inbox:{{ asset.asset_id }} &fleet:status &fleet:alerts &fleet:commands +@read +@pubsub +@connection +publish +ping +info

{% endfor %}
# =============================================================================
# MONITORING USER - Read-only access for Prometheus/Grafana
# =============================================================================
user monitoring on >${REDIS_PASSWORD_MONITORING} ~* +info +ping +client +dbsize +keys +scan +type +ttl +get +mget +hget +hgetall +lrange +smembers +zrange

# =============================================================================
# ADMIN USER - Full access for maintenance (use sparingly)
# =============================================================================
user admin on >${REDIS_PASSWORD_ADMIN} ~* &* +@all
